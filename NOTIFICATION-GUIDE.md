# iOS 系统通知使用指南

## 📱 功能概述

COC建筑工人计时器现已支持iOS系统通知功能，当建筑升级完成时会自动发送通知提醒，让您不错过任何重要的升级完成时间。

## 🚀 快速开始

### 1. 开启通知权限

1. 打开应用后，点击右上角的 **设置按钮** (⚙️)
2. 在配置对话框中找到 **"通知设置"** 区域
3. 点击 **"升级完成通知"** 开关
4. 浏览器会弹出权限请求，点击 **"允许"**

### 2. iOS Safari 特殊设置

由于iOS Safari的限制，需要额外设置：

1. **添加到主屏幕**：
   - 在Safari中打开应用
   - 点击底部分享按钮 📤
   - 选择 **"添加到主屏幕"**
   - 从主屏幕图标启动应用

2. **通知权限**：
   - 只有从主屏幕启动的PWA应用才能发送通知
   - 确保在iOS设置中允许应用通知

## 🔔 通知类型

### 即将完成通知
- **触发时间**：升级完成前1分钟
- **内容**：显示哪个玩家的哪个建筑即将完成升级
- **目的**：提前准备，避免建筑工人闲置

### 升级完成通知
- **触发时间**：升级完成时
- **内容**：显示具体完成的建筑和玩家信息
- **目的**：及时安排下一个升级任务

## 📋 使用步骤

### 第一步：添加玩家数据
1. 点击 **"快速粘贴"** 按钮或手动输入JSON数据
2. 解析玩家数据，系统会自动识别正在升级的建筑

### 第二步：开启通知
1. 进入设置 → 通知设置
2. 开启 **"升级完成通知"** 开关
3. 授权浏览器通知权限

### 第三步：等待通知
- 应用会自动监控升级进度
- 在升级完成前1分钟和完成时发送通知
- 点击通知可快速回到应用

## 🔧 技术特性

### PWA 通知支持
- **Service Worker集成**：使用Service Worker发送通知，提供更好的离线支持
- **智能回退**：如果Service Worker不可用，自动使用浏览器原生通知API
- **iOS优化**：针对iOS Safari的通知限制进行了特殊优化

### 通知管理
- **防重复**：同一升级项目不会重复发送通知
- **智能标签**：使用唯一标签避免通知堆积
- **自动清理**：通知会在10秒后自动关闭（iOS要求）

## 🌐 浏览器兼容性

| 浏览器 | 支持状态 | 备注 |
|--------|----------|------|
| iOS Safari | ✅ 支持 | 需要添加到主屏幕 |
| Chrome (iOS) | ✅ 支持 | 完整支持 |
| Firefox (iOS) | ✅ 支持 | 完整支持 |
| Safari (macOS) | ✅ 支持 | 完整支持 |
| Chrome (桌面) | ✅ 支持 | 完整支持 |
| Firefox (桌面) | ✅ 支持 | 完整支持 |
| Edge | ✅ 支持 | 完整支持 |

## 🛠️ 故障排除

### 通知不工作？

1. **检查权限**：
   - 确保浏览器通知权限已开启
   - iOS用户确保从主屏幕启动应用

2. **检查设置**：
   - 确认应用内通知开关已开启
   - 检查系统通知设置是否允许

3. **重新授权**：
   - 如果权限被拒绝，需要在浏览器设置中手动开启
   - 清除浏览器数据后重新授权

### iOS 特殊问题

1. **通知不显示**：
   - 确保应用已添加到主屏幕
   - 从主屏幕图标启动，而不是Safari浏览器

2. **权限被拒绝**：
   - 进入iOS设置 → 通知 → 找到应用 → 开启通知

## 💡 使用技巧

### 最佳实践
1. **及时响应**：收到通知后及时处理，避免建筑工人闲置
2. **合理规划**：根据通知时间安排下一个升级任务
3. **多账号管理**：为不同账号设置备注，便于识别

### 高级功能
- **批量管理**：支持同时监控多个玩家的升级进度
- **实时更新**：升级时间会实时更新，确保通知准确
- **离线支持**：即使网络断开，本地数据仍会继续计时

## 🔒 隐私说明

- **本地存储**：所有数据仅存储在您的设备上
- **无服务器**：不会向任何服务器发送您的游戏数据
- **权限最小化**：仅请求必要的通知权限

## 📞 技术支持

如果您在使用过程中遇到问题：

1. 检查本指南的故障排除部分
2. 确保使用最新版本的浏览器
3. 尝试清除浏览器缓存后重新加载应用

---

**享受更智能的COC升级管理体验！** 🎮